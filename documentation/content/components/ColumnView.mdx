import {ColumnView} from '@react/react-spectrum/ColumnView';
import {ExampleDS, ds, ds2, renderItem, renderDetail} from '../helpers/TreeView';

A **ColumnView** displays heirarchical data as a set of columns that can be progressively disclosed to 
navigate to a desired item, or select a set of items. It supports many advanced features like asynchronous data loading, 
multiple selection, keyboard navigation, detail columns, and more. It is designed to scale to collections of any size using a virtual 
scroller that only renders the currently visible items in each column into the DOM.

## Example

<ColumnView
  dataSource={ds}
  renderItem={renderItem}
  renderDetail={renderDetail}
  allowsSelection
  allowsBranchSelection />

```jsx
import {ColumnView} from '@react/react-spectrum/ColumnView';

<ColumnView
  dataSource={dataSource}
  renderItem={renderItem}
  renderDetail={renderDetail}
  allowsSelection
  allowsBranchSelection />
```

See below for details about these props.

## Overview

To set up a ColumnView, a couple pieces are required: a data source to provide the items to display, and a `renderItem` 
function to render the UI for an individual item.

### Data Sources

A data source provides the data for a ColumnView to display, and responds to user initiated actions such as drag and drop.
Data sources can be shared across multiple types of views that display heirarchical data, e.g. ColumnView and [TreeView](/components/TreeView).
Since ColumnView uses objects as keys, data returned by data sources must be unique: the same object cannot be returned more than once.

There is a base class for data sources that can be used by ColumnView called [TreeDataSource](/classes/TreeDataSource), which supports asynchronous
loading of data, and events to update data later. To provide data, implement the `getChildren` method and return the data for
the child items of the provided parent. If the parent is `null`, then provide the root items. You must also implement the
`hasChildren` method to let ColumnView know whether an item should display the disclosure indicator indicating it has children.

```javascript
import TreeDataSource from '@react/react-spectrum/TreeDataSource';

class MyDataSource extends TreeDataSource {
  async getChildren(parent) {
    if (!parent) {
      // If parent is null, load the root items.
      return [...];
    }

    // Otherwise, load the children.
    return [...];
  }

  hasChildren(parent) {
    // Return whether the parent has children
    return true;
  }
}
```

When data in the data source changes, perhaps in response to some external event such as a server update, the data source 
should emit events. The column view listens for these events and updates its views as necessary. There are helper methods as part 
of the base data source class that you can call to insert, update, remove, or move items in the column view. You can also use 
transactions to group multiple updates together into a single animation. See the [API docs](/classes/TreeDataSource) for details.

### Item Renderers

The last required piece for a ColumnView is a `renderItem` prop, which is just a function to render the contents of an item.
It receives the data for the item to render.

```jsx
function renderItem(item) {
  return <span>{...}</span>;
}
```

## Item Navigation

ColumnView lets the user navigate to an item by progressively expanding items along a navigation path. As the user navigates
into items, ColumnView calls the data source's `getChildren` method to load the child items as needed. The `onNavigate` prop
will also be called to notify you that the navigation path changed. You can control the navigated path using the `navigatedPath`
prop, e.g. to pre-load some items into view when loading the column view.

```jsx
<ColumnView
  {...otherProps}
  navigatedPath={[...]}
  onNavigate={(navigatedPath) => {}} />
```

## Detail Columns

ColumnView supports rendering a detail column for leaf items to allow users to see more details about the item they have
navigated to. This can be enabled by providing a `renderDetail` prop, which receives the data for the item to render.

```jsx
function renderDetail(item) {
  return (
    <div>
      <h4>Detail</h4>
      <div>{...}</div>
    </div>
  );
}
```

## Selection

ColumnView supports multiple selection out of the box, indicated by checkboxes on each item. Selection can
be enabled using the `allowsSelection` prop. By default, only leaf items can be selected. You can enable branches
to also be selectable using the `allowsBranchSelection` prop.

To handle selection changes, you can use the `onSelectionChange` prop. This will be passed a list of item objects, as provided
by the data source.

To set the selection programmatically, provide the `selectedItems` prop to the ColumnView. This should be an array of item objects,
with object identity equal to the ones provided by the data source.

```jsx
<ColumnView
  {...otherProps}
  allowsSelection
  selectedItems={[...]}
  onSelectionChange={(selectedItems) => {}} />
```

## Object Equality

Since ColumnView uses objects as keys to many of its methods, the items you return from `getChildren` might not be the same objects
you pass to the `navigatePath` prop, or the `selectedItems` prop. Perhaps you only have the ids until the full item objects are actually
loaded. In order for the column view to know which objects you are referring to, you can implement the `isItemEqual` comparator method 
on your data source and return a boolean to determine if two items are equal. Then you could pass objects with only an id to the `navigatedPath`
or `selectedItems` props on initial render, for example.

```javascript
class MyDataSource extends TreeDataSource {
  // ...

  isItemEqual(a, b) {
    return a.id === b.id;
  }
}
```

## Accessibility

ColumnView implements the aria tree design pattern. It handles multiselection, item focusing, and is fully keyboard accessibile out of the box.

## Internationalization

To internationalize a ColumnView, you should provide localized content as needed, for example item content formatting.
